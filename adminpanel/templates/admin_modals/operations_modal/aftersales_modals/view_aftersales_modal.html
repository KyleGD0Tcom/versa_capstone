{% load static %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
    body {
        font-family: 'Rubik', sans-serif;
    }

    .custom-indent {
        margin-left: 8.5rem;
    }

    .section-title {
        color: #033b60;
    }

    .attachment-img {
        width: 100%;
        height: 350px;
        object-fit: cover;
    }
</style>

<div class="modal fade" id="{{ modal_id }}" tabindex="-1" aria-labelledby="{{ modal_id }}Label" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content p-5" style="border-radius: 12px;">
            <!-- Header -->
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold" id="{{ modal_id }}Label" style="color: #033b60;">
                    {{ maintenance.maintenance_id }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Body -->
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <!-- Order Details Section -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3 d-flex">
                        <div class="text-secondary" style="width: 150px;">Order ID:</div>
                        <div class="ms-3">
                            {% if maintenance.sales_order and maintenance.sales_order.order_number %}
                                {{ maintenance.sales_order.order_number }}
                            {% elif maintenance.service and maintenance.service.sales_order %}
                                {{ maintenance.service.sales_order.order_number }}
                            {% else %}
                                N/A
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6 mb-3 d-flex">
                        <div class="text-secondary" style="width: 150px;">Service ID:</div>
                        <div class="ms-3">{{ maintenance.service_id }}</div>
                    </div>
                    <div class="col-md-6 mb-3 d-flex">
                        <div class="text-secondary" style="width: 150px;">Date Received:</div>
                        <div class="ms-3">{{ maintenance.created_at|date:"F j, Y" }}</div>
                    </div>
                    <div class="col-md-6 mb-3 d-flex">
                        <div class="text-secondary" style="width: 150px;">Status:</div>
                        <div class="ms-3">
                            {% if maintenance.status == 'Completed' %}
                                <span style="background-color: rgb(222, 243, 219); border-radius: 5px;" class="p-1 text-success">{{ maintenance.status }}</span>
                            {% elif maintenance.status == 'In Progress' %}
                                <span style="background-color: #cfe2ff; color: #084298; border-radius: 5px;" class="p-1">{{ maintenance.status }}</span>
                            {% elif maintenance.status == 'Pending' %}
                                <span style="background-color: rgb(241, 238, 211); border-radius: 5px;" class="p-1 text-warning">{{ maintenance.status }}</span>
                            {% else %}
                                <span style="background-color: #e2e3e5; border-radius: 5px;" class="p-1">{{ maintenance.status }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Client Information Section -->
                <div class="mb-4">
                    <h6 class="mb-3" style="color: #033b60;">CLIENT INFORMATION</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 120px;">Name:</div>
                                <div class="ms-5">{{ maintenance.client_name }}</div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 120px;">Company:</div>
                                <div class="ms-5">{% if maintenance.service and maintenance.service.sales_order %}{{ maintenance.service.sales_order.company_name }}{% else %}N/A{% endif %}</div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 120px;">Contact:</div>
                                <div class="ms-5">{% if maintenance.service and maintenance.service.sales_order %}{{ maintenance.service.sales_order.client_contact }}{% else %}N/A{% endif %}</div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 120px;">Email:</div>
                                <div class="ms-5">{% if maintenance.service and maintenance.service.sales_order %}{{ maintenance.service.sales_order.client_email }}{% else %}N/A{% endif %}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Breakdown Section -->
                <div class="mb-4">
                    <h6 class="mb-3" style="color: #033b60;">PRODUCT BREAKDOWN</h6>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Item Description</th>
                                    <th>Serial Number</th>
                                    <th>Quantity</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{% if maintenance.service %}{{ maintenance.service.unit_name }}{% else %}{{ maintenance.unit_name }}{% endif %}</td>
                                    <td><b>{% if maintenance.service %}{{ maintenance.service.serial_number }}{% else %}{{ maintenance.serial_number }}{% endif %}</b></td>
                                    <td>{% if maintenance.service and maintenance.service.sales_order and maintenance.service.sales_order.items.first %}{{ maintenance.service.sales_order.items.first.quantity }}{% else %}1{% endif %}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Warranty Details Section -->
                <div class="mb-4">
                    <h6 class="mb-3" style="color: #033b60;">WARRANTY DETAILS</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3 d-flex">
                                <div class="text-secondary" style="width: 120px;">Start Date:</div>
                                <div class="ms-5">
                                    {% if maintenance.service %}
                                        {{ maintenance.service.warranty_start|date:"F j, Y" }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                            </div>
                            <div class="mb-3 d-flex">
                                <div class="text-secondary" style="width: 120px;">End Date:</div>
                                <div class="ms-5">
                                    {% if maintenance.service %}
                                        {{ maintenance.service.warranty_end|date:"F j, Y" }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                            </div>
                            <div class="mb-3 d-flex">
                                <div class="text-secondary" style="width: 120px;">Remaining Days:</div>
                                <div class="ms-5">
                                    {% if maintenance.service %}
                                        {% with days_left=maintenance.service.warranty_end|timeuntil %}
                                            {{ days_left }}
                                        {% endwith %}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Issue Details Section -->
                <div class="mb-4">
                    <h6 class="mb-3" style="color: #033b60;">ISSUE DETAILS</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="d-flex align-items-center">
                                <div class="text-secondary" style="width: 150px;">Request Type:</div>
                                <div class="ms-3">Repair</div>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 150px;">Reported Problem:</div>
                                <textarea class="form-control ms-3" rows="3" readonly>{{ maintenance.reported_problem }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Technician Details Section -->
                <div class="mb-4">
                    <h6 class="mb-3" style="color: #033b60;">TECHNICIAN DETAILS</h6>
                    <div class="row">
                        <label class="col-auto col-form-label text-secondary text-end pt-2 align-self-start" style="min-width: 120px;">Technicians:</label>
                        <div class="col ms-3">
                            <div class="assistants-container">
                                {% if maintenance.technicians.all %}
                                    {% for technician in maintenance.technicians.all %}
                                        <div class="d-flex gap-2 mb-2">
                                            <input type="text" class="form-control assistant-input w-50" value="{{ technician.name }}" readonly>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="d-flex gap-3 mb-2">
                                        <input type="text" class="form-control assistant-input w-50 ms-2" value="Not Assigned" readonly>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <h6 class="mb-3 mt-3" style="color: #033b60;">RESULTS &amp; FINDINGS</h6>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 150px;">Diagnosis:</div>
                                <textarea class="form-control ms-3" rows="3" readonly>{{ maintenance.diagnosis|default_if_none:"" }}</textarea>
                            </div>
                        </div>
                        <div class="col-12 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 150px;">Findings/Note:</div>
                                <textarea class="form-control ms-3" rows="3" readonly>{{ maintenance.findings_note|default_if_none:"" }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ACTIONS TAKEN Section -->
                <div class="mb-4">
                    <h6 class="mb-3" style="color: #033b60;">ACTIONS TAKEN</h6>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="d-flex">
                                <div class="text-secondary" style="width: 150px;">Work Performed:</div>
                                <textarea class="form-control ms-3" rows="3" readonly>{{ maintenance.work_performed|default_if_none:"" }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>