<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->

</head>
<style>
    th {
        opacity: 0.3;
    }

    .labels {
        opacity: 0.7;
    }
</style>

{% for order in orders %}
<!-- Edit Sales Order Modal -->
<div class="modal fade" id="editOrdersModal{{ order.id }}" tabindex="-1" aria-labelledby="editOrdersModalLabel{{ order.id }}" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content p-5" style="border-radius: 12px;">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold" id="editOrdersModalLabel{{ order.id }}">
                    <span style="color: #033b60;">{{ order.order_number }}</span>
                </h5>
                <button type="button" class="btn-close ms-auto" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <form id="editOrderForm{{ order.id }}" enctype="multipart/form-data">
                    {% csrf_token %}
                <div class="row mb-4">
                    <div class="col-md-3 text-secondary">Order Date:</div>
                    <div class="col-md-9">
                            <input type="date" class="form-control" name="order_date" value="{{ order.order_date|date:'Y-m-d' }}" readonly>
                        </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-3 text-secondary">Delivery Date:</div>
                    <div class="col-md-9">
                            <input type="date" class="form-control" name="delivery_date" value="{{ order.delivery_date|date:'Y-m-d' }}" required>
                        </div>
                </div>

                <div class="row mb-4">
                        <div class="col-md-3 text-secondary">Delivery Instructions:</div>
                    <div class="col-md-9">
                            <textarea class="form-control" name="delivery_instructions" rows="4">{{ order.delivery_instructions }}</textarea>
                        </div>
                </div>

                <br>
                <hr>

                    <!-- Client & Seller Info -->
                <div class="row mb-5 mt-5">
                    <div class="col-md-6">
                        <h6 class="fw-bold mb-4" style="color: #033b60;">CLIENT INFORMATION</h6>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Name:</label>
                                <input type="text" class="form-control" name="client_name" value="{{ order.client_name }}" required style="flex: 2;">
                        </div>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Address:</label>
                                <input type="text" class="form-control" name="client_address" value="{{ order.client_address }}" required style="flex: 2;">
                        </div>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Contact:</label>
                                <input type="text" class="form-control" name="client_contact" value="{{ order.client_contact }}" required style="flex: 2;">
                        </div>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Email:</label>
                                <input type="email" class="form-control" name="client_email" value="{{ order.client_email }}" required style="flex: 2;">
                            </div>
                    </div>

                    <div class="col-md-6">
                        <h6 class="fw-bold mb-4" style="color: #033b60;">SELLER INFORMATION</h6>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Company:</label>
                                <input type="text" class="form-control" name="company_name" value="{{ order.company_name }}" required style="flex: 2;">
                        </div>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Address:</label>
                                <input type="text" class="form-control" name="company_address" value="{{ order.company_address }}" required style="flex: 2;">
                        </div>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Contact:</label>
                                <input type="text" class="form-control" name="company_contact" value="{{ order.company_contact }}" required style="flex: 2;">
                        </div>

                        <div class="d-flex mb-3">
                            <label class="form-label text-secondary" style="flex: 1;">Email:</label>
                                <input type="email" class="form-control" name="company_email" value="{{ order.company_email }}" required style="flex: 2;">
                            </div>
                    </div>
                </div>

                    <!-- Payment Details -->
                <div class="row mb-3">
                    <div class="col-12">
                        <h6 class="fw-bold" style="color: #033b60;">PAYMENT DETAILS</h6>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="row mb-2">
                                <div class="col-4 text-secondary">Payment Mode:</div>
                            <div class="col-8">
                                    <input type="text" class="form-control" name="payment_mode" value="{{ order.payment_mode }}" readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cash Payment Fields -->
                    <div id="cashFields{{ order.id }}" class="payment-fields" {% if order.payment_mode != 'cash' %}style="display: none;"{% endif %}>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="row mb-2">
                                    <div class="col-4 text-secondary">Due Date:</div>
                                    <div class="col-8">
                                        <input type="date" class="form-control" name="due_date" value="{{ order.due_date|date:'Y-m-d' }}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row mb-2">
                                    <div class="col-4 text-secondary">Amount Paid:</div>
                            <div class="col-8">
                                        <input type="number" class="form-control" name="amount_paid" value="{{ order.amount_paid }}" readonly>
                                    </div>
                                </div>
                        </div>
                    </div>
                </div>

                    <!-- Other Payment Types Fields -->
                    <div id="otherPaymentFields{{ order.id }}" class="payment-fields" {% if order.payment_mode == 'cash' %}style="display: none;"{% endif %}>
                        <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="row mb-2">
                                    <div class="col-4 text-secondary">Residence Location:</div>
                            <div class="col-8">
                                        <input type="text" class="form-control" name="residence_location" value="{{ order.residence_location }}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row mb-2">
                            <div class="col-4 text-secondary">Due Date:</div>
                            <div class="col-8">
                                        <input type="date" class="form-control" name="due_date" value="{{ order.due_date|date:'Y-m-d' }}" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bank Statement Details -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div style="color: #033b60;">BANK STATEMENT</div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="row mb-2">
                                    <div class="col-4 text-secondary">Bank Account:</div>
                                    <div class="col-8">
                                        <input type="text" class="form-control" name="bank_account" value="{{ order.bank_account }}" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row mb-2">
                                    <div class="col-4 text-secondary">Account Number:</div>
                                    <div class="col-8">
                                        <input type="text" class="form-control" name="account_number" value="{{ order.account_number }}" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="row mb-2">
                                    <div class="col-4 text-secondary">Amount Paid:</div>
                                    <div class="col-8">
                                        <input type="number" class="form-control" name="amount_paid" value="{{ order.amount_paid }}" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br>

                    <!-- Attachments Section -->
                    <div class="row mb-2">
                    <div class="col-12">
                        <h6 class="fw-bold" style="color: #033b60;">ATTACHMENTS</h6>
                    </div>
                </div>

                    <!-- Cash Payment Attachments -->
                    <div id="cashAttachments{{ order.id }}" class="attachment-fields" {% if order.payment_mode != 'cash' %}style="display: none;"{% endif %}>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="row mb-2">
                                    <div class="col-4 text-secondary">ID:</div>
                                    <div class="col-8">
                                        {% if order.id_attachment %}
                                        <a href="{{ order.id_attachment.url }}" target="_blank" class="btn btn-sm btn-outline-primary">View ID</a>
                                        {% else %}
                                        <span class="text-muted">No ID attached</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Other Payment Types Attachments -->
                    <div id="otherAttachments{{ order.id }}" class="attachment-fields" {% if order.payment_mode == 'cash' %}style="display: none;"{% endif %}>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="row mb-2">
                                    <div class="col-4 text-secondary">Business Permit:</div>
                                    <div class="col-8">
                                        {% if order.business_permit %}
                                        <a href="{{ order.business_permit.url }}" target="_blank" class="btn btn-sm btn-outline-primary">View Business Permit</a>
                                        {% else %}
                                        <span class="text-muted">No Business Permit attached</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-4 text-secondary">BIR:</div>
                                    <div class="col-8">
                                        {% if order.bir_attachment %}
                                        <a href="{{ order.bir_attachment.url }}" target="_blank" class="btn btn-sm btn-outline-primary">View BIR Document</a>
                                        {% else %}
                                        <span class="text-muted">No BIR Document attached</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Breakdown -->
                <h6 class="fw-bold mb-3" style="color: #033b60;">PRODUCT BREAKDOWN</h6>
                <div>
                    <div class="border p-3 rounded-3 mb-5 mt-3">
                        <div class="table-responsive mt-2">
                                <table class="table align-middle" id="productTable{{ order.id }}">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Item Code</th>
                                        <th>Serial Number</th>
                                        <th>Quantity</th>
                                        <th>Unit Price</th>
                                        <th>Total Price</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                        {% for item in order.items.all %}
                                        <tr data-item-id="{{ item.inventory_item.id }}">
                                            <td>{{ item.inventory_item.unit_item }}</td>
                                            <td>{{ item.inventory_item.item_code }}</td>
                                            <td>{{ item.inventory_item.serial_number }}</td>
                                            <td>{{ item.quantity }}</td>
                                            <td>₱ {{ item.unit_price }}</td>
                                            <td>₱ {{ item.total_price }}</td>
                                        <td>
                                            <i class="edit-btn bi bi-pencil-square fs-4" style="color: orange;"></i>
                                                <i class="delete-btn bi bi-trash fs-4" style="color: red;"></i>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                                <button type="button" class="btn text-white add-item-btn" data-order-id="{{ order.id }}"
                                style="background-color: #033b60; float: right; font-size: 12px; margin-right: 10px;">Add
                                More</button>
                        </div>
                    </div>

                        <!-- Item Edit Form -->
                        <div id="editItemForm{{ order.id }}" class="p-3 border bg-light rounded d-none">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Edit Item</h6>
                                <button type="button" class="btn-close close-form-btn" data-order-id="{{ order.id }}"></button>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Item</label>
                                    <select class="form-select item-select" data-order-id="{{ order.id }}">
                                        <option value="">Select Item</option>
                                        {% for item in items %}
                                        <option value="{{ item.id }}">{{ item.unit_item }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control quantity" min="1" data-order-id="{{ order.id }}">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Item Code</label>
                                    <input type="text" class="form-control item-code" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Serial Number</label>
                                    <input type="text" class="form-control serial-number" readonly>
                            </div>
                                <div class="col-md-6">
                                    <label class="form-label">Unit Price</label>
                                    <input type="text" class="form-control unit-price" readonly>
                            </div>
                                <div class="col-md-6">
                                    <label class="form-label">Total Price</label>
                                    <input type="text" class="form-control total-price" readonly>
                            </div>
                            </div>

                            <div class="mt-3 text-end">
                                <button type="button" class="btn btn-primary save-changes-btn" data-order-id="{{ order.id }}">Save Changes</button>
                            </div>
                        </div>
                    </div>

                <!-- Summary -->
                <div class="row mb-2">
                    <div class="col-md-12">
                        <h6 class="fw-bold" style="color: #033b60;">SUMMARY</h6>
                    </div>
                </div>

                <div class="row mb-5">
                    <div class="col-md-12">
                        <table class="table table-borderless">
                            <tr>
                                    <td style="padding-left: 100px;">Total Amount</td>
                                    <td class="text-start">₱ <span id="totalAmount{{ order.id }}">{{ order.total_amount }}</span></td>
                            </tr>
                            <tr>
                                    <td style="padding-left: 100px;">Amount Paid</td>
                                    <td class="text-start">₱ <span id="amountPaid{{ order.id }}">{{ order.amount_paid }}</span></td>
                            </tr>
                            <tr class="fw-bold border-top">
                                    <td style="padding-left: 100px;">Balance</td>
                                    <td class="text-start">₱ <span id="balance{{ order.id }}">{{ order.remaining_balance }}</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
                </form>
            </div>

            <hr>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success update-order-btn" data-order-id="{{ order.id }}">Save Changes</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<script>
    function togglePaymentFields(orderId) {
        const paymentMode = document.querySelector(`#editOrdersModal${orderId} [name="payment_mode"]`).value;
        const cashFields = document.getElementById(`cashFields${orderId}`);
        const otherPaymentFields = document.getElementById(`otherPaymentFields${orderId}`);
        const cashAttachments = document.getElementById(`cashAttachments${orderId}`);
        const otherAttachments = document.getElementById(`otherAttachments${orderId}`);

        if (paymentMode === 'cash') {
            cashFields.style.display = 'block';
            otherPaymentFields.style.display = 'none';
            cashAttachments.style.display = 'block';
            otherAttachments.style.display = 'none';
        } else {
            cashFields.style.display = 'none';
            otherPaymentFields.style.display = 'block';
            cashAttachments.style.display = 'none';
            otherAttachments.style.display = 'block';
        }
    }

    function updateItemDetails(select, orderId) {
        const form = document.getElementById(`editItemForm${orderId}`);
        if (select.value) {
            // Detect warehouse or sales context
            const isWarehouse = window.location.pathname.includes('/warehouse/');
            const endpoint = isWarehouse
                ? `/warehouse/get-item-details/${select.value}/`
                : `/sales/get-item-details/${select.value}/`;

            fetch(endpoint)
                .then(response => response.json())
                .then(data => {
                    form.querySelector('.item-code').value = data.item_code || '';
                    form.querySelector('.serial-number').value = data.serial_number || '';
                    form.querySelector('.unit-price').value = data.unit_price || '';
                    updateTotalPrice(orderId);
                });
        } else {
            form.querySelector('.item-code').value = '';
            form.querySelector('.serial-number').value = '';
            form.querySelector('.unit-price').value = '';
            form.querySelector('.total-price').value = '';
        }
    }

    function updateTotalPrice(orderId) {
        const form = document.getElementById(`editItemForm${orderId}`);
        const quantity = parseFloat(form.querySelector('.quantity').value) || 0;
        const unitPrice = parseFloat(form.querySelector('.unit-price').value) || 0;
        form.querySelector('.total-price').value = (quantity * unitPrice).toFixed(2);
    }

    function addNewItem(orderId) {
        const form = document.getElementById(`editItemForm${orderId}`);
        form.classList.remove('d-none');
        form.querySelectorAll('input, select').forEach(input => {
            if (!input.readOnly) input.value = '';
        });
    }

    function closeItemForm(orderId) {
        document.getElementById(`editItemForm${orderId}`).classList.add('d-none');
    }

    function saveItemChanges(orderId) {
        const form = document.getElementById(`editItemForm${orderId}`);
        const table = document.getElementById(`productTable${orderId}`).getElementsByTagName('tbody')[0];
        const select = form.querySelector('.item-select');
        const itemId = select.value;
        const itemName = select.options[select.selectedIndex].text;

        // Get all values from the form
        const itemCode = form.querySelector('.item-code').value;
        const serialNumber = form.querySelector('.serial-number').value;
        const quantity = form.querySelector('.quantity').value;
        const unitPrice = form.querySelector('.unit-price').value;
        const totalPrice = form.querySelector('.total-price').value;

        // Only add if item is selected and quantity is set
        if (itemId && quantity) {
            const newRow = table.insertRow();
            newRow.setAttribute('data-item-id', itemId);
            newRow.innerHTML = `
                <td>${itemName}</td>
                <td>${itemCode}</td>
                <td>${serialNumber}</td>
                <td>${quantity}</td>
                <td>₱ ${unitPrice}</td>
                <td>₱ ${totalPrice}</td>
                <td>
                    <i class="edit-btn bi bi-pencil-square fs-4" style="color: orange;"></i>
                    <i class="delete-btn bi bi-trash fs-4" style="color: red;"></i>
                </td>
            `;

            // Add event listeners to the new row's buttons
            const editBtn = newRow.querySelector('.edit-btn');
            const deleteBtn = newRow.querySelector('.delete-btn');
            editBtn.addEventListener('click', () => editItem(newRow, orderId));
            deleteBtn.addEventListener('click', () => deleteItem(newRow, orderId));

            closeItemForm(orderId);
            updateOrderSummary(orderId);
        } else {
            alert('Please select an item and enter a quantity.');
        }
    }

    function editItem(row, orderId) {
        const form = document.getElementById(`editItemForm${orderId}`);
        const cells = row.cells;
        
        // Find and select the correct option in the dropdown
        const select = form.querySelector('.item-select');
        Array.from(select.options).forEach(option => {
            if (option.text === cells[0].textContent.trim()) {
                option.selected = true;
            }
        });
        
        form.querySelector('.item-code').value = cells[1].textContent;
        form.querySelector('.serial-number').value = cells[2].textContent;
        form.querySelector('.quantity').value = cells[3].textContent;
        form.querySelector('.unit-price').value = cells[4].textContent.replace('₱', '').trim();
        form.querySelector('.total-price').value = cells[5].textContent.replace('₱', '').trim();
        
        form.classList.remove('d-none');
        row.remove();
    }

    function deleteItem(row, orderId) {
        row.remove();
        updateOrderSummary(orderId);
    }

    function updateOrderSummary(orderId) {
        const table = document.getElementById(`productTable${orderId}`);
        let total = 0;
        
        table.querySelectorAll('tbody tr').forEach(row => {
            const totalPrice = parseFloat(row.cells[5].textContent.replace('₱', '').replace(',', '')) || 0;
            total += totalPrice;
        });
        
        document.getElementById(`totalAmount${orderId}`).textContent = total.toFixed(2);
        const amountPaid = parseFloat(document.getElementById(`amountPaid${orderId}`).textContent) || 0;
        document.getElementById(`balance${orderId}`).textContent = (total - amountPaid).toFixed(2);
    }

    function updateOrder(orderId) {
        const form = document.getElementById(`editOrderForm${orderId}`);
        const formData = new FormData();
        const orderData = {
            client_name: form.querySelector('[name="client_name"]').value,
            client_address: form.querySelector('[name="client_address"]').value,
            client_contact: form.querySelector('[name="client_contact"]').value,
            client_email: form.querySelector('[name="client_email"]').value,
            company_name: form.querySelector('[name="company_name"]').value,
            company_address: form.querySelector('[name="company_address"]').value,
            company_contact: form.querySelector('[name="company_contact"]').value,
            company_email: form.querySelector('[name="company_email"]').value,
            delivery_date: form.querySelector('[name="delivery_date"]').value,
            delivery_instructions: form.querySelector('[name="delivery_instructions"]').value,
            payment_mode: form.querySelector('[name="payment_mode"]').value,
            due_date: form.querySelector('[name="due_date"]').value,
            amount_paid: form.querySelector('[name="amount_paid"]').value,
            residence_location: form.querySelector('[name="residence_location"]')?.value || '',
            bank_account: form.querySelector('[name="bank_account"]')?.value || '',
            account_number: form.querySelector('[name="account_number"]')?.value || '',
            items: []
        };

        // Get items data
        const table = document.getElementById(`productTable${orderId}`);
        table.querySelectorAll('tbody tr').forEach(row => {
            const itemId = row.getAttribute('data-item-id');
            if (itemId) {
                orderData.items.push({
                    item_id: itemId,
                    quantity: parseInt(row.cells[3].textContent),
                    unit_price: parseFloat(row.cells[4].textContent.replace('₱', '').trim())
                });
            }
        });

        // Add the order data to formData
        formData.append('order_data', JSON.stringify(orderData));

        // Determine if we're in warehouse or sales context
        const isWarehouse = window.location.pathname.includes('/warehouse/');
        const endpoint = isWarehouse ? `/warehouse/update-order/${orderId}/` : `/sales/update-order/${orderId}/`;

        // Send the update request
        fetch(endpoint, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name="csrfmiddlewaretoken"]').value
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Close the modal (if using Bootstrap 5)
                const modal = bootstrap.Modal.getInstance(document.getElementById('editOrdersModal' + orderId));
                if (modal) modal.hide();
                alert('Order updated successfully!');
                location.reload();
            } else {
                alert('Error updating order: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating order: ' + error);
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Add item button handler
        document.querySelectorAll('.add-item-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                addNewItem(this.dataset.orderId);
            });
        });

        // Close form button handler
        document.querySelectorAll('.close-form-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                closeItemForm(this.dataset.orderId);
            });
        });

        // Item select change handler
        document.querySelectorAll('.item-select').forEach(select => {
            select.addEventListener('change', function() {
                updateItemDetails(this, this.dataset.orderId);
            });
        });

        // Quantity change handler
        document.querySelectorAll('.quantity').forEach(input => {
            input.addEventListener('change', function() {
                updateTotalPrice(this.dataset.orderId);
            });
        });

        // Save changes button handler
        document.querySelectorAll('.save-changes-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                saveItemChanges(this.dataset.orderId);
            });
        });

        // Update order button handler
        document.querySelectorAll('.update-order-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                updateOrder(this.dataset.orderId);
            });
        });

        // Initialize existing items
        document.querySelectorAll('[id^="productTable"]').forEach(table => {
            const orderId = table.id.replace('productTable', '');
            table.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => editItem(btn.closest('tr'), orderId));
            });
            table.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteItem(btn.closest('tr'), orderId));
            });
        });
    });
</script>